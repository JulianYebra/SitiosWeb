<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Club Atlético Independiente</title>
  <link rel="icon" href="https://images.vexels.com/media/users/3/190212/isolated/preview/4a228e5707fcb2963c8275dc2ed42a78-diablo-rojo-del-personaje.png" type="image/png">
  <link rel="stylesheet" href="estilo.css">
</head>
<body>

<header class="titulo">
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Escudo_del_Club_Atl%C3%A9tico_Independiente.svg/250px-Escudo_del_Club_Atl%C3%A9tico_Independiente.svg.png" alt="Escudo de Independiente" class="escudo">
  <h1>Club Atlético Independiente</h1>
</header>

<nav>
  <a href="index.html"><button>Menú</button></a>
    <a href="jugadores.html"><button>Jugadores</button></a> 
  <a href="titulos.html"><button>Títulos</button></a>
</nav>

<div id="CounterVisitor"></div>

<section id="jugadores">
  <h2>Los 3 mejores jugadores del plantel actualmente</h2>
  <div id="destacados"></div> <!-- aca se insertan los jugadores desde JS -->
</section>


<script>
  function scrollToSection(id) {
    document.getElementById(id).scrollIntoView({ behavior: "smooth" });
  }
</script>

<script>
  
async  function dibujarContador(data) {

//localStorage.setItem("datosJSON", result);


    var n = data.visitas;


    if (n === null) {
      n = 0;
    }
    n++;
    //localStorage.setItem("on_load_counter", n);

    data.visitas = n;

    let nums = n.toString().split('').map(Number);
    let counterHTML = '<div class="counter-title">Visitas a la página</div>';
    counterHTML += '<div class="counter-number">';
      for (var i of nums) {
        counterHTML += '<div class="counter-digit">' + i + '</div>';
      }
    counterHTML += '</div>';
    counterHTML += '<div class="counter-label"></div>';

    document.getElementById('CounterVisitor').innerHTML = counterHTML;

      updateBin(data);

  }
</script>


<script src="jsonbin-client.js"></script>
<script>

    // Esto se ejecutará una sola vez cuando la página se cargue por primera vez
    window.addEventListener('DOMContentLoaded', function () {
      //console.log('La página se ha renderizado por primera vez');
      // Aquí puedes poner cualquier lógica que quieras ejecutar solo una vez
      leerContador();
    });

  async function leerContador() {
            const binId = '68929a10ae596e708fc29f09';
            
            try {
                
              const result = await jsonbinClient.readBin();

              dibujarContador( result.record);

              contarVotos(result.record.votos)




            } catch (error) {
                console.log(`❌ Error al leer bin: ${error.message}`, 'error');
            }
        }
</script>

<script>

  async function updateBin(data){
    
    
      try {
      
        const result = await jsonbinClient.updateBin(data);   
      }
      catch(error) {
                  console.log(`❌ Error al actualizar bin: ${error.message}`, 'error');
        
      }
    }

</script>


<script>

function contarVotos(votos){

  // Convertir el objeto en un array de pares [clave, valor]
  const pares = Object.entries(votos);

  // Ordenar por la cantidad de votos, de mayor a menor
  const ordenados = pares.sort((a, b) => b[1] - a[1]);

  // Tomar los primeros 3
  const top3 = ordenados.slice(0, 3);

  localStorage.setItem("JugadoresDestacados",JSON.stringify(top3))

  //return JSON.stringify(top3); // Devuelve array de [clave, valor]
}

</script>


<script src="destacados.js"></script>

<footer>
  <a href="index.html">Menú</a>
  |
  <a href="jugadores.html">Jugadores</a>
  |
  <a href="titulos.html">Títulos</a>
  |
  <a href="index.html">Reseñas</a>
</footer>

</body>
</html>